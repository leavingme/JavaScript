var Widget={};(function(){var a='<div class="loading" style="width:48px;height:48px;position:relative;margin:auto;top:0px;"><img src="'+$var.css_path+'images/loading.gif" width="48" height="48" /></div>';$.fn.loading=function(c,b){this.each(function(h){var j=$(this);var g={};var d=parseInt(j.offsetHeight||j.css("height"));g=$.extend({top:d?(d/2-24):30},b);if(typeof c=="undefined"){var f=a}else{var f=a.replace("loading.gif","loading_"+c+".gif")}j.html(f);if(g.top!=null){j.find(".loading").css("top",g.top+"px")}if(g.left!=null){j.find(".loading").css("left",g.left+"px")}});return this};$.fn.unloading=function(){this.each(function(b){$(this).find(".loading").remove()});return this}})();(function(){$.tree={on_change:function(a,b){},on_slide:function(a,b){},slide:function(a,f){var c=$("#tree-"+a);var g="#node-"+f;var d=c.find(g);var b=d.attr("act_class");c.find("."+b).removeClass(b);d.attr("slide","true").addClass(b);this.on_slide(a,f);this.on_change(a,f)},on_toggle:function(a,b){},toggle:function(a,f){var c=$("#tree-"+a);var g="#node-"+f;var d=c.find(g);var b=d.attr("act_class");d.toggleClass(b);this.on_toggle(a,f);this.on_change(a,f)},on_action:function(a,b){},action:function(a,f){var c=$("#tree-"+a);var g="#node-"+f;var d=c.find(g);var b=d.attr("act_class");c.find("."+b).removeClass(b);d.attr("action","true").addClass(b);this.on_action(a,f);this.on_change(a,f)}};$.fn.tree=function(c,a){if(arguments.length==0){return this.html()}else{if(arguments.length==1){if(typeof c=="string"){var e=c;var b=null}else{if(typeof c=="object"){var e=null;var b=c}}}else{if(arguments.length==2){var e=c;var b=a}else{var e=null;var b=null}}}var d=$.extend({},b||{});if(d.on_toggle){$.tree.on_toggle=d.on_toggle}if(d.on_slide){$.tree.on_slide=d.on_slide}if(d.on_action){$.tree.on_action=d.on_action}if(d.on_change){$.tree.on_action=d.on_change}$.tree.el=this;if(e!=null){this.html(e)}return this}})();(function(b){document.oncontextmenu=function(){return false};var d={};var c=null;var a=null;b.contextmenu={is_open:false,is_hold:false,lazy_id:null,lazy_timeout:1000*1.5,open:function(g){var j=82;var e=98;var f=ui_api.get_window_size();var i=g.pageY;var h=g.pageX;if(i+e>f.height){i=i-e}if(h+j>f.width){h=f.width-j-2}if(c){this.is_open=true;c.css({top:i,left:h});c.fadeIn("fast")}},close:function(){if(this.lazy_id){clearTimeout(this.lazy_id);this.lazy_id=null}if(c){this.is_open=false;c.fadeOut("fast")}},hold:function(){this.is_hold=true},unhold:function(){this.is_hold=false},_lazyClose:function(){var e=this;if(!this.is_hold){b("#localgame .my-games-icon .game-item").attr("class","game-item");this.close()}else{this.lazy_id=setTimeout(function(){e._lazyClose()},this.lazy_timeout)}},lazyClose:function(){var e=this;this.lazy_id=setTimeout(function(){e._lazyClose()},this.lazy_timeout)}};b.fn.contextmenu=function(f){var g=b.extend({el:null,callback:{}},f||{});var h=g.el;var i=function(k){var l=b(k);var j=l.attr("app_id");b('#localgame .my-games-icon .game-item[app_id!="'+j+'"]').attr("class","game-item")};if(h){if(!d[h]){var e=b(h);e.hover(function(){b.contextmenu.hold()},function(){b.contextmenu.unhold()}).find(".contextmenu-item").bind("click",function(j){var k=b(this);var l=k.attr("callback");l&&g.callback[l]&&g.callback[l].call(a,j);b.contextmenu.close()});d[h]=e}this.bind("contextmenu",function(j){c=d[h];a=this;b.contextmenu.open(j);b.contextmenu.lazyClose()});this.mousedown(function(){i(this)});this.mouseenter(function(){b(this).addClass("game-item-hover");i(this);c=d[h];if(a===this){b.contextmenu.hold()}else{b.contextmenu.close()}});this.mouseleave(function(){if(!b.contextmenu.is_open){b(this).removeClass("game-item-hover")}c=d[h];if(a===this){b.contextmenu.unhold()}else{b.contextmenu.close()}})}return this}})($jQuery);(function(){$.dialog={CONFIRM_BTN:1,CANCEL_BTN:2,LOGIN_BTN:4,_is_open:false,_opt:{},title:function(a){$("#dialog .title span").html(a)},content:function(a){$("#dialog .content").html(a)},open:function(a){if(!this._is_open){this._opt=$.extend({el:"",width:0,height:0,btn:this.CONFIRM_BTN|this.CANCEL_BTN,text_confirm:"",text_cancel:"",long_confirm:false,long_cancel:false,show_content:true,on_open:function(c){},on_close:function(c,e){}},a||{});$("#dialog-overlay").show();var b=$("#dialog");b.css({width:(this._opt.width+32)+"px",height:(this._opt.height+106)+"px"}).show().find(".content").html(this._opt.el);if(this._opt.btn==0){b.find(".action").hide();b.css({height:(this._opt.height+51)+"px"})}else{b.find(".action").show();b.find("#dialog_btn_login").show();b.find("#dialog_btn_confirm").show();b.find("#dialog_btn_cancel").show();if((this._opt.btn&this.LOGIN_BTN)==0){b.find("#dialog_btn_login").hide()}if((this._opt.btn&this.CONFIRM_BTN)==0){b.find("#dialog_btn_confirm").hide()}if((this._opt.btn&this.CANCEL_BTN)==0){b.find("#dialog_btn_cancel").hide()}b.find("#dialog_btn_confirm").html(this._opt.text_confirm||"\u786e\u5b9a").removeClass("yes_btn_long").removeClass("yes_btn").addClass(this._opt.long_confirm?"yes_btn_long":"yes_btn");b.find("#dialog_btn_cancel").html(this._opt.text_cancel||"\u53d6\u6d88").removeClass("no_btn_long").removeClass("no_btn").addClass(this._opt.long_cancel?"no_btn_long":"no_btn");if(!this._opt.show_content){b.css({height:(this._opt.height+45)+"px"}).find(".content").hide()}else{b.css({height:(this._opt.height+106)+"px"}).find(".content").show()}}this._is_open=true;this._opt.on_open.call(this,b)}},center:function(f,e){if(this._is_open){var g=$("#dialog");var c=parseInt(g.css("width"));var a=parseInt(g.css("height"));var b=ui_api.get_window_size();g.css("left",((b.width-c)/2+(f||0))+"px");g.css("top",((b.height-a)/2+(e||0))+"px")}},close:function(a){if(this._is_open){$("#dialog-overlay").hide();var b=$("#dialog").hide();this._is_open=false;this._opt.on_close.call(this,a,b)}}};$.alert=new function(){var a='<div class="alert"><div class="alert_text ${ICON}">${TEXT}</div></div>';this.title=function(b){$.dialog.title(b)};this.content=function(b){$("#dialog .content .alert").html(b)};this.open=function(b){b=$.extend({width:300,height:50,title:"\u63d0\u793a"},b||{});b.el=a.replace("${TEXT}",b.text||b.el||"").replace("${ICON}",b.icon||"");var c=b.on_close;b.on_close=function(d){if(d=="login"){client_api.login()}c&&c(d)};$.dialog.open(b);$.dialog.title(b.title);$.dialog.center()};this.center=function(c,b){$.dialog.center(c,b)};this.close=function(b){$.dialog.close(b)}}})();(function(){$.lightips=new function(){var a=false;var b=3*1000;var c=null;this.COLOR={LIGHT_GREEN:"#94C01D",DEEP_YELLOW:"#F88C0C",WHITE:"#FFF"};this.show=function(f,e){a=true;e=e||{};var d=e.bColor||this.COLOR.LIGHT_GREEN;var g=e.fColor||this.COLOR.WHITE;$("#light-tips").css({backgroundColor:d,color:g}).html(f).show();this.center();if(c){clearTimeout(c)}if(e.lazy_hide){var i=this;c=setTimeout(function(){i.hide()},typeof e.lazy_hide=="number"?e.lazy_hide:b)}};this.hide=function(){$("#light-tips").hide();a=false};this.center=function(e){if(a){var d=ui_api.get_window_size();$("#light-tips").css("left",((d.width-320)/2+(e||0))+"px")}}}})();Widget.Knowledge={};Widget.Knowledge.iKnow=function(a){Widget.Knowledge.setKnowledge(a)};Widget.Knowledge.getKnowledge=function(knowledgePoint){var result=false;var strKnowledge=client_api.read_file("knowledge");var knowledge={};if(strKnowledge!=""){try{knowledge=eval("("+strKnowledge+")")}catch(e){}}if(knowledge[knowledgePoint]){result=true}return result};Widget.Knowledge.setKnowledge=function(knowledgePoint){var strKnowledge=client_api.read_file("knowledge");var knowledge={};if(strKnowledge!=""){try{knowledge=eval("("+strKnowledge+")")}catch(e){}}knowledge[knowledgePoint]=true;strKnowledge=JSON.stringify(knowledge);client_api.write_file("knowledge",strKnowledge)};Widget.GameSound={};Widget.GameSound.show=function(b){Widget.GameSound.move();var a=$jQuery(".game-sound");a.fadeIn("slow")};Widget.GameSound.hide=function(){var a=$jQuery(".game-sound");a.fadeOut("slow");Widget.GameSound.onHide()};Widget.GameSound.onHide=function(){};Widget.GameSound.move=function(){var b=ui_api.get_window_size();var d=40;var c=b.width-215;var a=$jQuery(".game-sound");a.css({top:d,left:c})};Widget.GameOperate={};Widget.GameOperate.show=function(b){Widget.GameOperate.move();var a=$jQuery(".game-operate");if(b&&b!=""){a.find(".content").html(b)}a.fadeIn("slow")};Widget.GameOperate.hide=function(){var a=$jQuery(".game-operate");a.fadeOut("slow")};Widget.GameOperate.move=function(){var a=ui_api.get_window_size();var d=65;var c=a.width-215;var b=$jQuery(".game-operate");b.css({top:d,left:c})};Widget.GameFeedback={};Widget.GameFeedback.show=function(b){Widget.GameFeedback.move();var a=$jQuery(".game-feedback");a.fadeIn("slow")};Widget.GameFeedback.hide=function(){var a=$jQuery(".game-feedback");a.fadeOut("slow")};Widget.GameFeedback.move=function(){var b=ui_api.get_window_size();var d=b.height-140;var c=b.width-215;var a=$jQuery(".game-feedback");a.css({top:d,left:c})};Widget.AppTip={};Widget.AppTip.show=function(b,g){G_SHOW_TIPS=true;var k=$jQuery(g);var l=k.parents(".gamelist_item");var c=k.width();var f=k.offset();var i=f.top-95;var e=f.left-(168-c)/2;if(i<0){return}if(e<0){e=5}var a=l.find(".name").html();var h=k.attr("category_name");var j=k.attr("size");var d=k.attr("time");$jQuery(".fapp-name").html(a);$jQuery(".fapp-cate").html("\u6240\u5c5e\u5206\u7c7b: &nbsp;"+h);$jQuery(".fapp-size").html("\u6e38\u620f\u5927\u5c0f: &nbsp;"+j);$jQuery(".fapp-time").html("\u9996\u6b21\u52a0\u8f7d\u65f6\u95f4: &nbsp;"+d);$jQuery(".flow-tips").css({top:i,left:e}).show()};Widget.AppTip.hide=function(){G_SHOW_TIPS=false;setTimeout(function(){if(G_SHOW_TIPS){return}$jQuery(".fapp-name").html("");$jQuery(".fapp-cate").html("");$jQuery(".fapp-size").html("");$jQuery(".fapp-time").html("");$jQuery(".flow-tips").hide();G_SHOW_TIPS=false},50)};Widget.GameList={};Widget.GameList.gamelist=function(f,k,d,h){var j,a,e;var i=function(p){p=p/1024;var q=["K","M","G","T"];var o=0;for(o=0;p>=1024&&o<3;o++){p=p/1024}if(p>0){p=p.toFixed(1)}else{p=0}return p==0?"\u5c0f\u4e8e10K":p+q[o]};var m=function(o){var p="";if(o<60){p="1\u5206\u949f\u5185"}else{if(o>=60&&o<3600){p=parseInt(o/60)+"\u5206\u949f"}else{if(o>=3600&&o<3600*4){p=parseInt(o/3600)+"\u5c0f\u65f6"}else{if(o>=3600*4){p="\u5927\u4e8e4\u5c0f\u65f6"}}}}return p};var n={LIST:['<div class="gamelist_wrapper">',"${GAMELIST_ITEMS}",'<div style="clear:both;"></div></div>'].join(""),ITEM:['<div class="gamelist_item">','<div class="inneritem">','<div class="icon" onmouseenter="Widget.AppTip.show(event, this);" onmouseleave="Widget.AppTip.hide();" category_name="${CATEGORY_NAME}" size="${SIZE}" time="${TIME}">','<a href="javascript:;" onclick="${RUN_LINK}" class="img-link" title="\u5c31\u73a9\u5b83">','<img src="${SRC}" />',"</a>",'<div class="name_wrap">','<a href="javascript:void(0);" onclick="${DETAIL_LINK}" title="\u67e5\u770b ${APP_NAME} \u8be6\u60c5">','<div class="name word-ellipsis">${APP_NAME}</div>','<div class="detail">\u67e5\u770b\u8be6\u60c5</div>',"</a>","</div>","</div>",'<div class="info">','<div class="app_name word-ellipsis">${APP_NAME}</div>','<div class="rate score_${SCORE_LEVEL}">',"\u8bc4\u5206:","</div>",'<div class="run_count word-ellipsis">',"\u4eba\u6c14:${RUN_COUNT}","</div>",'<div class="update_time">','\u65e5\u671f:<span class="${DATE_STYLE}">${UPDATE_DATE}</span>',"</div>",'<div class="type_icons">${TYPE_ICONS}</div>',"</div>","</div>","</div>"].join(""),TOP_ITEM:['<div class="gamelist_item">','<div class="inneritem">','<div class="icon" onmouseenter="Widget.AppTip.show(event, this);" onmouseleave="Widget.AppTip.hide();" category_name="${CATEGORY_NAME}" size="${SIZE}" time="${TIME}">','<a href="javascript:void(0);" onclick="${DETAIL_LINK}" class="img-link" title="\u5c31\u73a9\u5b83">','<img src="${SRC}" />',"</a>",'<div class="name_wrap">','<a href="javascript:void(0);" onclick="${DETAIL_LINK}" title="\u67e5\u770b ${APP_NAME} \u8be6\u60c5">','<div class="name word-ellipsis">${APP_NAME}</div>','<div class="detail">\u67e5\u770b\u8be6\u60c5</div>',"</a>","</div>","</div>",'<div class="info">','<div class="col_name">','<div class="app_name word-ellipsis"><a href="javascript:void(0);" onclick="${DETAIL_LINK}" style="color: #fff;">${APP_NAME}&nbsp;</a></div>','<div class="type_icons">${TYPE_ICONS}</div>',"</div>",'<div class="rate score_${SCORE_LEVEL}">\u8bc4\u5206:&nbsp;</div>','<div class="run_count word-ellipsis">${RUN_COUNT}</div>',"</div>","</div>","</div>"].join(""),ALBUM_ITEM:['<div class="gamelist_item">','<div class="inneritem">','<div class="icon" onmouseenter="Widget.AppTip.show(event, this);" onmouseleave="Widget.AppTip.hide();" category_name="${CATEGORY_NAME}" size="${SIZE}" time="${TIME}">','<a href="javascript:void(0);" onclick="${DETAIL_LINK}" class="img-link" title="\u5c31\u73a9\u5b83">','<img src="${SRC}" />',"</a>",'<div class="name_wrap">','<a href="javascript:void(0);" onclick="${DETAIL_LINK}" title="\u67e5\u770b ${APP_NAME} \u8be6\u60c5">','<div class="name word-ellipsis">${APP_NAME}</div>','<div class="detail">\u67e5\u770b\u8be6\u60c5</div>',"</a>","</div>","</div>",'<div class="info">','<div class="title">','<div class="app_name"><a href="javascript:void(0);" onclick="${DETAIL_LINK}" style="color: #fff;">${APP_NAME}&nbsp;</a></div>','<div class="type_icons">${TYPE_ICONS}</div>',"</div>",'<div class="evaluation">','<div class="rate score_${SCORE_LEVEL}">\u8bc4\u5206:&nbsp;</div>','<div class="run_count word-ellipsis">\u4eba\u6c14:&nbsp;${RUN_COUNT}</div>',"</div>",'<div class="update_time">','\u65e5\u671f:<span class="${DATE_STYLE}">${UPDATE_DATE}</span>',"</div>",'<div class="app_desc">${DESC}</div>',"</div>",'<div class="action">','<a href="${RUN_LINK}" class="btn" onclick="this.blur();">\u8fd0&nbsp;\u884c</a>',"</div>","</div>","</div>"].join(""),CATEGORY_ITEM:['<div class="gamelist_item">','<div class="inneritem">','<div class="icon" onmouseenter="Widget.AppTip.show(event, this);" onmouseleave="Widget.AppTip.hide();" category_name="${CATEGORY_NAME}" size="${SIZE}" time="${TIME}">','<a href="javascript:void(0);" onclick="${DETAIL_LINK}" class="img-link" title="\u5c31\u73a9\u5b83">','<img src="${SRC}" />',"</a>",'<div class="name_wrap">','<a href="javascript:void(0);" onclick="${DETAIL_LINK}" title="\u67e5\u770b ${APP_NAME} \u8be6\u60c5">','<div class="name word-ellipsis">${APP_NAME}</div>','<div class="detail">\u67e5\u770b\u8be6\u60c5</div>',"</a>","</div>","</div>",'<div class="info">','<div class="app_name word-ellipsis"><a href="javascript:void(0);" onclick="${DETAIL_LINK}" style="color: #fff;">${APP_NAME}&nbsp;</a></div>','<div class="rate score_${SCORE_LEVEL}">\u8bc4\u5206:&nbsp;</div>','<div class="run_count word-ellipsis">\u4eba\u6c14:&nbsp;${RUN_COUNT}</div>','<div class="update_time">','\u65e5\u671f:<span class="${DATE_STYLE}">${UPDATE_DATE}</span>',"</div>",'<div class="type_icons">${TYPE_ICONS}</div>',"</div>","</div>","</div>"].join("")};var c=function(v){var H=v.app_id;var B=v.app_name.replace(/[(\uff08].*[\uff09)]/,"");var w=v.url_name;var A=v.run_count?v.run_count:0;var G=v.score||v.rating_avg_score;var x=G?Math.ceil(G/2):0;var t=RunManager.cmd({app:v,mid:j,sid:a});var q="apps/detail/main.html?appid="+H+"&appname="+encodeURIComponent(B)+"&entrance="+a;var M=H;var r=B;var F="client_api.navTabForLocalUrl('"+q+"', '"+M+"', '"+r+"');";var u="";if(e!=""){u=client_api.get_app_resource(H,"logo.jpg")}else{u=client_api.get_app_resource(H,"w_m_cover.jpg")}var z="";if(v.publish_update_time){z=v.publish_update_time.slice(5,10)}var J=new Date();var I=J.getMonth()+"-"+J.getDate();var o=[];if(v.speed_4m){o.push('<span class="spd_icon"></span>')}if(v.category_second_id=="300"){o.push('<span class="fla_icon"></span>')}if(v.category_second_id=="40"){o.push('<span class="pc_icon"></span>')}if(v.category_second_id=="41"){o.push('<span class="og_icon"></span>')}if(v.category_second_id=="335"){o.push('<span class="web_icon"></span>')}if(v.category_second_id=="321"){o.push('<span class="emu_icon"></span>')}if(v.language=="\u7b80\u4f53\u4e2d\u6587"){o.push('<span class="cn_icon"></span>')}var K="";var E=v.category.replace(/\|/g,"").split(",");K=E[1];var C=parseInt(v.package_size||v.initial_size);var L=i(C);var y=parseInt(v.initial_size);var s=parseInt(y/(128*1024));var D=m(s);var p="";if(v.brief_description){p=v.brief_description}return{app_id:H,url_name:w,app_name:B,category_name:K,run_link:t,detail_link:F,run_count:A,score_level:x,src:u,size:L,time:D,desc:p,type_icons:o.join(""),date_style:z==I?"today":"",update_date:z}};j=k;a=d;e="";var b="";if(h&&h!=""){e=h;var l=(h+"_ITEM").toUpperCase();var g=data_api.render(n[l],f,c);b=new Template(n.LIST).render_for_json({gamelist_items:g})}else{var g=data_api.render(n.ITEM,f,c);b=new Template(n.LIST).render_for_json({gamelist_items:g})}return b};
